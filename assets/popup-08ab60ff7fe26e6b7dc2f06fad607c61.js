(function(){window.AccountForm={popup:$("#popup_container"),login:$("#login_modal"),forgot:$("#forgot_modal"),show:function(form){return AccountForm.popup.hasClass("hidden")&&AccountForm.popup.hide()&&AccountForm.popup.removeClass("hidden"),$("#login_modal, #forgot_modal").addClass("hidden"),"login"===form?/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?document.location=""+location.protocol+"//m."+location.hostname.replace("api.","")+"/account/login":AccountForm.login.removeClass("hidden"):"forgot"===form&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?document.location=""+location.protocol+"//m."+location.hostname.replace("api.","")+"/account/forgot":AccountForm.forgot.removeClass("hidden")),AccountForm.popup.fadeIn(function(){return"login"===form&&Login.form.children("input[name='email']").focus(),"forgot"===form?ForgotPassword.form.children("input[name='identifier']").focus():void 0})},hide:function(){return AccountForm.popup.fadeOut(function(){return AccountForm.popup.addClass("hidden")&&AccountForm.popup.removeAttr("style")})}},window.ForgotPassword={form:$("#forgot_password_form"),submitButton:$("#forgot_password_form").children("input[type='submit']"),_flash:$("#forgot_modal").children(".popup").children(".popup_body").children(".flash"),flash:function(message,isError){return isError?ForgotPassword._flash.addClass("error"):ForgotPassword._flash.removeClass("error"),ForgotPassword._flash.text(message),ForgotPassword._flash.removeClass("hidden")},submit:function(){return ForgotPassword.submitButton.val("Sending Reset..."),$.ajax({type:"POST",url:ForgotPassword.form.attr("action"),data:ForgotPassword.form.serialize()}).success(function(data){return ForgotPassword.flash(data.message,!1)}).fail(function(evt){var data;return data=JSON.parse(evt.responseText),ForgotPassword.flash(data.message,!0)}).always(function(){return ForgotPassword.submitButton.val("Reset Password")})}},window.Login={form:$("#login_form"),submitButton:$("#login_form").children("fieldset").children("input[type='submit']"),_flash:$("#login_modal").children(".popup").children(".popup_body").children(".flash"),flash:function(message,isError){return isError?Login._flash.addClass("error"):Login._flash.removeClass("error"),Login._flash.text(message),Login._flash.removeClass("hidden")},submit:function(){return Login.submitButton.val("Logging In..."),$.ajax({type:"POST",url:Login.form.attr("action"),data:Login.form.serialize()}).success(function(data){return Login.submitButton.val("Redirecting..."),window.location.href=data.redirect_to}).fail(function(evt){var data;return data=JSON.parse(evt.responseText),Login.flash(data.message,!0),Login.submitButton.val("Login")})},_queryStrings:function(name){var regex,results;return name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search),null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))}},$(function(){return $("#login_button").click(function(){return AccountForm.show("login")}),ForgotPassword.form.submit(function(evt){return evt.preventDefault(),ForgotPassword.submit()}),Login.form.submit(function(evt){return evt.preventDefault(),Login.submit()}),$(".cover").click(function(evt){return evt.stopPropagation()}),AccountForm.popup.click(function(){}),"true"===Login._queryStrings("login")&&AccountForm.show("login"),"true"===Login._queryStrings("forgot")?AccountForm.show("forgot"):void 0})}).call(this);